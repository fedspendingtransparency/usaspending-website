version: '3.7'

services:

  bundle-usaspending-website:
    container_name: bundle-usaspending-website
    image: usaspending-website
    build: .
    volumes: 
      - ./public:/node-workspace/public
    command: >
      /bin/sh -cex "
        cd  /node-workspace
        rm -rf public/*
        npm run ${ENV:-dev} --loglevel ${NPM_LOGLEVEL:-notice}
      "
    environment:
      USASPENDING_API: ${USASPENDING_API:-https://api.usaspending.gov/api/}
      ENV: ${ENV:-dev}
      MAPBOX_TOKEN: ${MAPBOX_TOKEN:-''}
      GA_TRACKING_ID: ${GA_TRACKING_ID:-''}

  usaspending-website:
    container_name: usaspending-website
    image: nginx:1.18
    ports:
      - 8020:80
    volumes:
      - ./public:/usr/share/nginx/html:ro
